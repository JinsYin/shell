# chmod

`chmod` 是 change mode 的缩写，即用于改变文件（常规文件、目录、Socket、字符文件、块文件 ...）的权限（即模式）和访问控制列表（ACL）。

## 参数

| 参数 | 描述                                                                                                           |
| ---- | -------------------------------------------------------------------------------------------------------------- |
| `-R` | 改变所有子文件（包括目录）的权限；慎用之，因为普通文件的权限（通常是 `644`）往往比目录的权限（通常是 `755`）低 |

## 模式（Mode）

文件模式分为 _绝对模式_ 和 _符号模式_。

### 绝对模式

绝对模式是一个八进制数，由下面的一个或多个值之和构成：

| 模式基本值 | 描述                                                                      |
| ---------- | ------------------------------------------------------------------------- |
| 4000       |                                                                           |
| 2000       |                                                                           |
| 1000       |                                                                           |
| 0400       | 允许 “owner” 读                                                           |
| 0200       | 允许 “owner” 写                                                           |
| 0100       | 如果是文件，允许 “owner” 执行；<br> 如果是目录，允许 “owner” 搜索该目录   |
| 0040       | 允许 “组成员” 读                                                          |
| 0020       | 允许 “组成员” 写                                                          |
| 0010       | 如果是文件，允许 “组成员” 执行；<br> 如果是目录，允许 “组成员” 搜索该目录 |
| 0004       | 允许 “其他人” 读                                                          |
| 0002       | 允许 “其他人” 写                                                          |
| 0001       | 如果是文件，允许 “其他人” 执行；<br> 如果是目录，允许 “其他人” 搜索该目录 |

常用模式解读：

* `644`：允许 “所有用户” 可读，仅允许 “owner” 可写
* `664`：允许 “所有用户” 可读，允许 “owner” 和 “组成员” 可写
* `755`：允许 “所有用户” 可读可执行（或可搜索），仅允许 “owner” 可写
* `775`：允许 “所有用户” 可读可执行（或可搜索），允许 “owner” 和 “组成员” 可写
* `777`：允许 “所有用户” 读写执行（或搜索）

### 符号模式

符合模式语法描述：

```ini
mode         ::= clause [, clause ...]
clause       ::= [who ...] [action ...] action
action       ::= op [perm ...]
who          ::= a | u | g | o
op           ::= + | - | =
perm         ::= r | s | t | w | x | X | u | g | o
```

| who | 描述                                                  |
| --- | ----------------------------------------------------- |
| `u` | 指定模式位的用户（user）                              |
| `g` | 指定模式位的组（groud）                               |
| `o` | 指定模式位的其他（other）部分                         |
| `a` | 等同于 `ugo`（`u` + `g` + `o`），即所有用户；默认选项 |

| 运算（op） | 描述     |
| ---------- | -------- |
| `+`        | 增加权限 |
| `-`        | 移除权限 |
| `=`        | 设置权限 |

| 参数（perm） | 描述                                                  |
| ------------ | ----------------------------------------------------- |
| `r`          | 读                                                    |
| `s`          | set-user-ID-on-execution 和 set-group-ID-on-execution |
| `t`          | sticky                                                |
| `w`          | 写                                                    |
| `x`          | 执行/搜索                                             |
| `X`          |                                                       |
| `u`          | 原模式下的用户权限                                    |
| `X`          | 原模式下的组权限                                      |
| `X`          | 原模式下的其他权限                                    |

模式解读：

`+x` | `a+x`：为所有用户增加一个可执行或可搜索权限

理解目录的 “搜索” 权限：

* 访问目录，如 `cd /tmp`
* 查找目录，如 `find /tmp -type d`

## 默认文件模式

* umask

## Also

* umask

## 示例

* 分析 `ls -l`

```sh
# 第一列：文件类型及文件权限
# 第 1 位：文件类型；'-'：普通文件，'d'：目录，'l'：链接文件，'c'：字符设备，'b'：块设备
# 后 9 位：文件权限；每 3 位代表一类用户的权限，依次是 ’owner权限、组成员权限、其他人权限‘
$ ls -l
-rwxr-xr-x  1 in  staff    0  7 13 18:40 b.txt
drwxr-xr-x  5 in  staff  160  7 11 21:35 c
```

* 对子文件设置不同的权限

`-R` 选项会改变所有子文件（包括目录）的权限，但通常我们希望目录和其他文件拥有不同的权限。

```sh
$ find . -type d -exec chmod 755 {} \; # 目录权限 755
$ find . -type f -exec chmod 644 {} \; # 文件权限 644
$ find . -path ./.git -prune -o -type f -exec chmod 644 {} \; # 排除 .git 目录（`-path ./.git -prune -o`）
```
